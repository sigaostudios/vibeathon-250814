<main id="app">
    <app-phaser-game></app-phaser-game>
    <div class="controls-panel">
        <div class="controls-header">
            <h3>Game Controls</h3>
            <div class="status-pill" [class.on]="statusLabel.includes('On')" [class.off]="statusLabel.includes('Off')">
                {{ statusLabel }}
            </div>
        </div>
        <div class="controls-grid">
            <button class="btn" [disabled]="!canToggleMovement" (click)="toggleMovement()">Toggle Movement</button>
            <button class="btn" [disabled]="!canAddSprite" (click)="addSprite()">Add New Sprite</button>
            <!-- <button class="btn" (click)="engageInEspionage()">Engage in Espionage</button> -->
            <a routerLink="/config" class="btn btn-secondary">Game Configuration</a>
        </div>
        <div class="sprite-position">
            <div class="label">Sprite Position</div>
            <pre>{{ spritePosition | json }}</pre>
        </div>
        
        <app-flight-notification></app-flight-notification>
    </div>

    <!-- Brandon Movie Recommendation Dialog -->
    <div class="movie-dialog-overlay" *ngIf="showMovieDialog" (click)="closeMovieDialog()">
        <div class="movie-dialog" (click)="$event.stopPropagation()">
            <div class="dialog-header">
                <h3>ðŸŽ© Brandon's Movie Corner</h3>
                <button class="close-btn" (click)="closeMovieDialog()">Ã—</button>
            </div>
            
            <div class="dialog-content">
                <!-- Step 1: Brandon asks what movies you like -->
                <div *ngIf="movieDialogStep === 'asking'" class="dialog-step">
                    <div class="brandon-speech">
                        <p>{{ brandonQuestion }}</p>
                    </div>
                    <div class="user-input">
                        <textarea 
                            [(ngModel)]="userMoviePreferences" 
                            placeholder="Tell Brandon what kind of movies you like..."
                            rows="4"
                            maxlength="500">
                        </textarea>
                        <button 
                            class="btn btn-primary" 
                            [disabled]="!userMoviePreferences.trim()" 
                            (click)="submitMoviePreferences()">
                            Ask Brandon
                        </button>
                    </div>
                </div>

                <!-- Step 2: Waiting for AI response -->
                <div *ngIf="movieDialogStep === 'waiting'" class="dialog-step">
                    <div class="loading-message">
                        <p>ðŸ¤” Brandon is muttering to himself and his poop sock...</p>
                        <div class="spinner"></div>
                    </div>
                </div>

                <!-- Step 3: Brandon's response -->
                <div *ngIf="movieDialogStep === 'responding'" class="dialog-step">
                    <div class="brandon-response">
                        <h4>Brandon's Recommendations:</h4>
                        <div class="response-text">{{ brandonResponse }}</div>
                    </div>
                    <div class="dialog-actions">
                        <button class="btn btn-secondary" (click)="askAnotherQuestion()">Ask Another Question</button>
                        <button class="btn" (click)="closeMovieDialog()">Thanks Brandon!</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
